<!-- 分類搜尋結果頁面上半部區塊 -->
<section class="bg-grey-f7 py-10 pb-20 h-101 overflow-hidden relative border-b border-transparent" style="border-image: linear-gradient(to right, transparent, #8B5CF6, transparent) 1;">
  <div class="mx-auto container relative">
    <!-- 背景裝飾圖片 -->
    <div class="absolute right-[-50px] top-0 w-105 h-105">
      <img
        src="assets/images/itemArea_bg.png"
        alt="背景裝飾"
        class="w-full h-full object-cover"
      />
    </div>
    <div class="flex flex-col gap-6">
      <!-- Section Title -->
      <div class="flex items-start justify-start relative h-19">
        <!-- Decorative Icon -->
        <div class="w-16 h-16">
          <img
            src="/assets/images/orange-80-decorate.svg"
            alt=""
            class="w-full h-full object-contain"
          />
        </div>
        <!-- Title Text - Overlapping the icon at bottom area -->
        <h2
          class="absolute -bottom-1 text-3xl font-bold text-grey-33 font-noto-sans-tc tracking-wider text-center"
        >
          探索課程
        </h2>
      </div>
      <!-- 載入狀態 -->
      @if (isTagsLoading()) {
        <div class="flex justify-center items-center py-10">
          <div class="text-lg text-grey-66">載入分類中...</div>
        </div>
      }

      <!-- 錯誤狀態 -->
      @if (tagsError()) {
        <div class="flex justify-center items-center py-10">
          <div class="text-lg text-red-50">{{ tagsError() }}</div>
        </div>
      }

      <!-- 主分類卡片 -->
      @if (!isTagsLoading() && !tagsError()) {
        <div class="flex justify-start gap-6 overflow-x-auto pb-4">
          @for (category of mainCategories(); track category.id) {
            <div
              (click)="selectMainCategory(category.id)"
              [class]="'p-5 w-30 h-30 text-center shadow-lg rounded-xl cursor-pointer transition-all hover:shadow-xl ' +
                      (category.isSelected ? 'bg-primary text-white' : 'bg-white text-grey-33')">
              <mat-icon
                [class]="'!w-10 !h-10 !text-[40px] !leading-10 mb-3 ' +
                        (category.isSelected ? '!text-white' : '!text-primary')"
                >{{ category.icon }}</mat-icon
              >
              <h3 class="text-xl-bold">{{ category.main_category }}</h3>
            </div>
          }
        </div>
      }
      <!-- 子分類標籤 -->
      @if (!isTagsLoading() && !tagsError() && currentSubCategories().length > 0) {
        <div class="flex justify-start gap-3 flex-wrap">
          @for (subCategory of currentSubCategories(); track subCategory.id) {
            <div
              (click)="selectSubCategory(subCategory.id)"
              [class]="'flex items-center justify-center rounded-lg h-10 box-border px-3 cursor-pointer transition-all ' +
                      (subCategory.isSelected ?
                        'bg-primary border border-primary text-white' :
                        'bg-white border border-grey-9f text-grey-33 hover:border-primary hover:text-primary')"
            >
              {{ subCategory.name }}
            </div>
          }
        </div>
      }

      <!-- 如果沒有子分類或未選擇主分類時的提示 -->
      @if (!isTagsLoading() && !tagsError() && selectedMainCategoryId() !== null && currentSubCategories().length === 0) {
        <div class="flex justify-center items-center py-4">
          <div class="text-sm text-grey-66">此分類暫無子分類</div>
        </div>
      }
    </div>
  </div>
</section>
<!-- 課程卡片區塊 -->
<section class="py-10">
  <div class="container mx-auto">
    <!-- 搜尋結果 Header -->
    <div class="flex justify-between items-center mb-10">
      <!-- 搜尋結果文字 -->
      <div class="flex items-end gap-2 text-3xl-bold text-grey-33">
        <span>共 {{ totalResults() }} 筆與「</span>
        <span class="text-purple">{{ selectedCategoryName() }}</span>
        <span>」相關課程</span>
      </div>
      
      <!-- 篩選選項 -->
      <div class="flex gap-0">
        <div class="flex items-center justify-center box-border px-4 border-r border-grey-d4 text-grey-66">最新課程</div>
        <div class="flex items-center justify-center box-border px-4 border-r border-grey-d4 text-orange-55 text-base-bold">最高人氣</div>
        <div class="flex items-center justify-center box-border px-4 border-grey-d4 text-grey-66">最低價格</div>
      </div>
    </div>

    <!-- 載入狀態 -->
    @if (isLoading()) {
      <div class="flex justify-center items-center py-20">
        <div class="text-lg text-grey-66">載入中...</div>
      </div>
    }

    <!-- 錯誤狀態 -->
    @if (error()) {
      <div class="flex justify-center items-center py-20">
        <div class="text-lg text-red-50">{{ error() }}</div>
      </div>
    }

    <!-- 課程卡片網格 -->
    @if (!isLoading() && !error()) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <tmf-course-card
          *ngFor="let course of courses(); trackBy: trackByCourse"
          [course]="course"
          class="w-full">
        </tmf-course-card>
      </div>
    }

    <!-- 分頁區塊 -->
    <tmf-pagination 
      [currentPage]="currentPage()"
      [totalResults]="totalResults()"
      [itemsPerPage]="itemsPerPage()"
      (pageChange)="onPageChange($event)">
    </tmf-pagination>
  </div>
</section>