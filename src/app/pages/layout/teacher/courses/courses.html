<div>
  <!-- 頁面標題和新增按鈕 -->
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl-bold text-grey-33">課程管理</h1>
    <tmf-button class="h-10" iconPosition="left" iconName="add" (click)="goToCreateCourse()"
      >新增課程</tmf-button
    >
  </div>


  <!-- 課程表格容器 -->
  <div class="bg-white">
    <!-- 桌面版表格 -->
    <div class="hidden lg:block">
      <tmf-table>
        <!-- 表格標題 -->
        <div thead class="flex w-full h-10">
          <div class="flex-1 px-4 flex items-center">
            <span class="text-white">課程圖</span>
          </div>
          <div class="flex-1 px-4 flex items-center gap-1">
            <span class="text-white">名稱</span>
            <span class="material-symbols-outlined text-base text-white"
              >swap_vert</span
            >
          </div>
          <div class="w-40 px-4 flex items-center">
            <span class="text-white">狀態</span>
          </div>
          <div class="w-32 px-4 flex items-center justify-center gap-1">
            <span class="text-white">上/下架</span>
            <span class="material-symbols-outlined text-base text-white"
              >swap_vert</span
            >
          </div>
          <div class="w-40 px-4 flex items-center justify-center">
            <span class="text-white">操作</span>
          </div>
        </div>

        <!-- 載入狀態 -->
        @if (isLoading()) {
          <div tbody class="h-36 flex border-b border-grey-d4 bg-white">
            <div class="flex items-center justify-center w-full h-full">
              <span class="text-grey-66">載入中...</span>
            </div>
          </div>
        }

        <!-- 錯誤狀態 -->
        @if (loadError()) {
          <div tbody class="h-36 flex border-b border-grey-d4 bg-white">
            <div class="flex items-center justify-center w-full h-full">
              <span class="text-red-500">{{ loadError() }}</span>
            </div>
          </div>
        }

        <!-- 空狀態 -->
        @if (!isLoading() && !loadError() && courses().length === 0) {
          <div tbody class="h-36 flex border-b border-grey-d4 bg-white">
            <div class="flex items-center justify-center w-full h-full">
              <span class="text-grey-66">目前沒有課程</span>
            </div>
          </div>
        }

        <!-- 課程列表 -->
        @for (courseItem of coursesWithActions(); track courseItem.id; let i = $index) {
          <div tbody class="h-36 flex border-b border-grey-d4 bg-white p-4 transition-colors hover:bg-grey-f7">
            <!-- 課程圖片 -->
            <div class="flex-1 px-4 flex items-center">
              @if (courseItem.imageUrl) {
                <img
                  [src]="courseItem.imageUrl"
                  [alt]="courseItem.name"
                  class="w-50 h-full object-cover rounded-lg"
                />
              } @else {
                <div
                  class="w-20 h-20 bg-grey-e9 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-grey-9f text-2xl"
                    >school</span
                  >
                </div>
              }
            </div>

            <!-- 課程名稱 -->
            <div class="flex-1 px-4 flex items-center">
              <h3 class="text-base text-grey-33 line-clamp-2">
                {{ courseItem.name }}
              </h3>
            </div>

            <!-- 課程狀態 -->
            <div class="w-40 px-4 flex items-center">
              <span
                class="px-2 py-1 rounded-sm text-sm text-center"
                [class]="courseItem.status | courseStatusClass"
              >
                {{ courseItem.status | courseStatus }}
              </span>
            </div>

            <!-- 上下架開關 -->
            <div class="w-32 px-4 flex items-center justify-center">
              <tmf-toggle-switch
                [checked]="courseItem.isPublished"
                [disabled]="!courseItem.canToggle"
                (toggleChange)="onToggleSwitchChange($event, courseItem)"
              ></tmf-toggle-switch>
            </div>

            <!-- 操作按鈕 -->
            <div
              class="w-40 px-4 flex flex-col items-center justify-center gap-2"
            >
              <button
                class="px-2 flex items-center w-12 h-7 box-border border border-grey-66 text-grey-66 hover:text-white hover:bg-grey-66 transition-colors duration-75 text-sm rounded-sm cursor-pointer align-middle"
                (click)="viewCourse(courseItem.id!)"
              >
                檢視
              </button>
              @if (courseItem.actions.includes('edit')) {
                <button
                  class="px-2 flex items-center w-12 h-7 box-border border border-grey-66 text-grey-66 hover:text-white hover:bg-grey-66 transition-colors duration-75 text-sm rounded-sm cursor-pointer align-middle"
                  (click)="editCourse(courseItem.id!)"
                >
                  編輯
                </button>
              }
              @if (courseItem.actions.includes('submit')) {
                <button
                  class="px-2 flex items-center w-12 h-7 box-border border border-primary text-primary hover:text-white hover:bg-primary transition-colors duration-75 text-sm rounded-sm cursor-pointer align-middle"
                  (click)="submitCourse(courseItem.id!)"
                >
                  審核
                </button>
              }
              @if (courseItem.actions.includes('delete')) {
                <button
                  class="px-2 flex items-center w-12 h-7 box-border border border-red-500 text-red-500 hover:text-white hover:bg-red-500 transition-colors duration-75 text-sm rounded-sm cursor-pointer align-middle"
                  (click)="deleteCourse(courseItem.id!)"
                >
                  刪除
                </button>
              }
            </div>
          </div>
        }
      </tmf-table>
    </div>
  </div>

  <!-- 分頁組件 -->
  <div class="mt-6 md:mt-8">
    <tmf-pagination
      [currentPage]="currentPage()"
      [totalResults]="totalResults()"
      [itemsPerPage]="itemsPerPage()"
      (pageChange)="onPageChange($event)"
    ></tmf-pagination>
  </div>
</div>
