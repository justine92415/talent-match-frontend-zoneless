<div class="bg-white min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h1 class="text-3xl font-bold text-grey-33 mb-2">å­¸ç”Ÿé ç´„ç®¡ç†</h1>
          <p class="text-grey-66">æŸ¥çœ‹å’Œç®¡ç†å­¸ç”Ÿçš„èª²ç¨‹é ç´„è¨˜éŒ„</p>
        </div>
      </div>
    </div>

    <!-- ç¯©é¸å·¥å…·åˆ— -->
    <div class="bg-white rounded-lg border border-grey-d4 p-6 mb-6">
      <form [formGroup]="filterForm">
      <div class="flex flex-wrap gap-4 items-center">
        <!-- èª²ç¨‹ç¯©é¸ -->
        <div class="min-w-48">
          <label class="block text-sm font-medium text-grey-33 mb-2">èª²ç¨‹ç¯©é¸</label>
          <tmf-input-select
            formControlName="course"
            placeholder="å…¨éƒ¨èª²ç¨‹"
            [options]="courseOptions">
          </tmf-input-select>
        </div>

        <!-- æ™‚é–“ç¯„åœ -->
        <div class="min-w-48">
          <label class="block text-sm font-medium text-grey-33 mb-2">æ™‚é–“ç¯„åœ</label>
          <tmf-input-select
            formControlName="timeRange"
            placeholder="å…¨éƒ¨æ™‚é–“"
            [options]="timeRangeOptions">
          </tmf-input-select>
        </div>

        <!-- é ç´„ç‹€æ…‹ -->
        <div class="min-w-48">
          <label class="block text-sm font-medium text-grey-33 mb-2">é ç´„ç‹€æ…‹</label>
          <tmf-input-select
            formControlName="status"
            placeholder="å…¨éƒ¨ç‹€æ…‹"
            [options]="statusOptions">
          </tmf-input-select>
        </div>

        <!-- å­¸ç”Ÿæœå°‹ -->
        <div class="min-w-48">
          <label class="block text-sm font-medium text-grey-33 mb-2">å­¸ç”Ÿæœå°‹</label>
          <tmf-input-text
            formControlName="student"
            placeholder="æœå°‹å­¸ç”Ÿå§“åæˆ– ID">
          </tmf-input-text>
        </div>

        <!-- ç¯©é¸æŒ‰éˆ• -->
        <tmf-button variant="primary" class="h-10" (click)="onSearchFilter()">
          æœå°‹ç¯©é¸
        </tmf-button>

        <!-- é‡ç½®æŒ‰éˆ• -->
        <tmf-button variant="secondary" class="h-10" (click)="onResetFilter()">
          é‡ç½®
        </tmf-button>
      </div>
      </form>
    </div>

    <!-- è¼‰å…¥ç‹€æ…‹ -->
    @if (reservationsResource.isLoading()) {
      <div class="space-y-4">
        @for (item of [1,2,3]; track item) {
          <div class="bg-white rounded-lg border border-grey-d4 p-6">
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center gap-3">
                <tmf-skeleton class="w-32 h-6 rounded"></tmf-skeleton>
                <tmf-skeleton class="w-24 h-5 rounded"></tmf-skeleton>
              </div>
              <tmf-skeleton class="w-16 h-6 rounded-full"></tmf-skeleton>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <tmf-skeleton class="w-20 h-4 rounded mb-2"></tmf-skeleton>
                <tmf-skeleton class="w-24 h-5 rounded mb-1"></tmf-skeleton>
                <tmf-skeleton class="w-16 h-4 rounded"></tmf-skeleton>
              </div>
              <div>
                <tmf-skeleton class="w-20 h-4 rounded mb-2"></tmf-skeleton>
                <tmf-skeleton class="w-32 h-5 rounded mb-1"></tmf-skeleton>
                <tmf-skeleton class="w-12 h-4 rounded"></tmf-skeleton>
              </div>
            </div>
            <div class="flex gap-3 pt-4 border-t border-grey-d4">
              <tmf-skeleton class="w-16 h-8 rounded"></tmf-skeleton>
              <tmf-skeleton class="w-16 h-8 rounded"></tmf-skeleton>
              <tmf-skeleton class="w-16 h-8 rounded"></tmf-skeleton>
            </div>
          </div>
        }
      </div>
    } @else if (reservationsResource.error()) {
      <div class="flex items-center justify-center p-8">
        <div class="text-center">
          <div class="text-red-600 mb-2">è¼‰å…¥å¤±æ•—</div>
          <button
            class="text-primary hover:underline"
            (click)="reservationsResource.reload()">
            é‡æ–°è¼‰å…¥
          </button>
        </div>
      </div>
    } @else {
      <!-- é ç´„è¨˜éŒ„åˆ—è¡¨ -->
      @if (reservationsResource.value()?.data?.reservations && reservationsResource.value()!.data!.reservations!.length > 0) {
        <div class="space-y-4">
          @for (reservation of reservationsResource.value()?.data?.reservations; track reservation.id) {
            <div class="bg-white rounded-lg border border-grey-d4 overflow-hidden hover:shadow-lg transition-shadow duration-200">
              <div class="p-6">
                <!-- é ç´„æ™‚é–“èˆ‡ç‹€æ…‹ -->
                <div class="flex justify-between items-start mb-4">
                  <div class="flex items-center gap-3">
                    <div class="text-xl font-bold text-grey-33">ğŸ“… {{ reservation.reserve_date | date:'yyyy-MM-dd' }}</div>
                    <div class="text-lg text-grey-66">{{ reservation.reserve_start_time }} - {{ reservation.reserve_end_time }}</div>
                  </div>
                  <span class="px-3 py-1 text-sm rounded-full" [ngClass]="getStatusClass(reservation.teacher_status, reservation.student_status)">
                    {{ getStatusText(reservation.teacher_status, reservation.student_status) }}
                  </span>
                </div>

                <!-- å­¸ç”Ÿèˆ‡èª²ç¨‹è³‡è¨Š -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-grey-33">ğŸ‘¤ å­¸ç”Ÿè³‡è¨Š</span>
                    </div>
                    <div class="text-base font-medium text-grey-33">{{ reservation.student?.nick_name || 'æœªçŸ¥å­¸ç”Ÿ' }}</div>
                    <div class="text-sm text-grey-66">ID: {{ reservation.student?.id || 'N/A' }}</div>
                  </div>
                  <div>
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-grey-33">ğŸ“š é ç´„èª²ç¨‹</span>
                    </div>
                    <div class="text-base font-medium text-grey-33">{{ reservation.course?.name || 'æœªçŸ¥èª²ç¨‹' }}</div>
                    <div class="text-sm text-grey-66">èª²ç¨‹ ID: {{ reservation.course?.id || 'N/A' }}</div>
                  </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="flex gap-3 pt-4 border-t border-grey-d4">
                  @if (reservation.teacher_status === 'pending' && reservation.student_status === 'reserved') {
                    <tmf-button variant="primary" size="sm" (click)="onConfirmReservation(reservation.id!)">
                      ç¢ºèªé ç´„
                    </tmf-button>
                    <tmf-button variant="tertiary" size="sm" class="text-red-50" (click)="onRejectReservation(reservation.id!)">
                      æ‹’çµ•é ç´„
                    </tmf-button>
                  } @else if (reservation.teacher_status === 'reserved' && reservation.student_status === 'reserved') {
                    <tmf-button variant="tertiary" size="sm" class="text-red-50" (click)="onCancelReservation(reservation.id!)">
                      å–æ¶ˆé ç´„
                    </tmf-button>
                  }
                  <tmf-button variant="tertiary" size="sm">
                    æŸ¥çœ‹è©³æƒ…
                  </tmf-button>
                  <tmf-button variant="secondary" size="sm">
                    è¯çµ¡å­¸ç”Ÿ
                  </tmf-button>
                </div>
              </div>
            </div>
          }
        </div>
      } @else {
        <!-- ç©ºç‹€æ…‹ -->
        <div class="text-center py-12">
          <div class="text-grey-66 text-lg mb-4">æš«ç„¡é ç´„è¨˜éŒ„</div>
          <div class="text-sm text-grey-66">ç•¶å­¸ç”Ÿé ç´„æ‚¨çš„èª²ç¨‹æ™‚ï¼Œè¨˜éŒ„æœƒé¡¯ç¤ºåœ¨é€™è£¡</div>
        </div>
      }
    }

    <!-- åˆ†é æ§åˆ¶ -->
    @if (reservationsResource.value()?.data?.pagination && reservationsResource.value()!.data!.pagination!.total_pages! > 1) {
      <div class="flex justify-center items-center gap-2 mt-8">
        <tmf-button
          variant="tertiary"
          size="sm"
          [disabled]="currentPage() <= 1"
          (click)="onPageChange(currentPage() - 1)">
          ä¸Šä¸€é 
        </tmf-button>
        <span class="text-sm text-grey-66 mx-4">
          ç¬¬ {{ currentPage() }} é  / å…± {{ reservationsResource.value()?.data?.pagination?.total_pages }} é 
        </span>
        <tmf-button
          variant="tertiary"
          size="sm"
          [disabled]="currentPage() >= (reservationsResource.value()?.data?.pagination?.total_pages || 1)"
          (click)="onPageChange(currentPage() + 1)">
          ä¸‹ä¸€é 
        </tmf-button>
      </div>
    }
  </div>
</div>