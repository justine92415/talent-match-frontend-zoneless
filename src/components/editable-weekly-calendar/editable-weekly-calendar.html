<div class="w-full overflow-x-auto calendar-container" [class.dragging]="isDragging()">
  <!-- 操作提示 -->
  <div class="mb-4">
    <h3 class="text-lg font-medium text-grey-33 mb-2">操作說明：</h3>
    <ul class="text-base text-grey-66 space-y-1">
      <li>• 點擊時段：切換可預約狀態</li>
      <li>• 拖拽選取：按住滑鼠左鍵拖拽可選取多個時段</li>
    </ul>
  </div>

  <!-- 週曆表格 -->
  <div class="min-w-160 border border-primary">
    <!-- 表格結構 -->
    <div class="flex">
      <!-- 時間欄位 -->
      <div class="flex flex-col">
        <!-- 空白區域（對應星期標題的位置） -->
        <div class="w-16 h-16 bg-orange-95 border-b border-primary"></div>
        <!-- 時間列表 -->
        <div class="w-16 bg-orange-95 border-primary">
          @for (time of times; track $index; let i = $index; let isLast = $last) {
            <div
              class="h-16 flex flex-col justify-center items-center py-2 border-b border-dashed border-orange-85"
              [class.border-b-0]="isLast"
            >
              <p class="text-base font-black text-grey-33">{{ i + 1 }}</p>
              <p class="text-sm font-bold text-primary">{{ time }}</p>
            </div>
          }
        </div>
      </div>

      <!-- 日期欄位 -->
      <div class="flex-1 flex">
        @for (day of schedule(); track day.week_day; let dayIndex = $index) {
          <div class="flex-1 flex flex-col">
            <!-- 星期標題 -->
            <div
              class="h-16 bg-orange-95 border-b border-primary flex flex-col justify-center items-center py-2 px-3 opacity-80 relative"
            >
              <p class="text-lg font-bold text-black">{{ day.week }}</p>
            </div>

            <!-- 時間槽位 -->
            <div class="flex-1 flex flex-col">
              @for (slot of day.slots; track $index; let slotIndex = $index; let isLastSlot = $last) {
                <div [class]="'h-16 p-2 opacity-80' + (!isLastSlot ? ' border-b border-dashed border-orange-85' : '')" [attr.data-slot-key]="day.week_day + '-' + slot.time">
                  <div
                    [class]="'w-full h-full rounded-lg border-2 flex items-center justify-center text-sm font-medium transition-all duration-200 ' + slot.cssClass"
                    (click)="onSlotClick(dayIndex, slotIndex, $event)"
                    (mousedown)="onMouseDown(dayIndex, slotIndex, $event)"
                    (mousemove)="onMouseMove(dayIndex, slotIndex, $event)"
                    (mouseup)="onMouseUp()">
                    <!-- 時段狀態顯示 -->
                    <div class="text-center">
                      <div class="text-xs mt-1">
                        @if (slot.status === "available") {
                          <span>可預約</span>
                        } @else {
                          <span>不可預約</span>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>

</div>
